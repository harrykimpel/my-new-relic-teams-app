{"version":3,"sources":["utils/felaFocusVisibleEnhancer.ts"],"names":["RULE_TYPE","felaFocusVisibleEnhancer","renderer","_emitChange","change","type","selector","indexOf","pseudo","replace","undefined","declarationReference","cache","enhancedChange"],"mappings":";AACA,SAASA,SAAT,QAA0B,YAA1B;;AAkBA;;;;;AAKA,IAAMC,wBAAwB,GAAG,SAA3BA,wBAA2B,CAACC,QAAD;AAAA,2BAC5BA,QAD4B;AAE/BC,IAAAA,WAAW,EAAE,qBAACC,MAAD,EAA4B;AACvC,UAAIA,MAAM,CAACC,IAAP,KAAgBL,SAAhB,IAA6BI,MAAM,CAACE,QAAP,CAAgBC,OAAhB,CAAwB,gBAAxB,MAA8C,CAAC,CAAhF,EAAmF;AACjF,YAAMC,MAAM,GAAGJ,MAAM,CAACI,MAAP,GAAgBJ,MAAM,CAACI,MAAP,CAAcC,OAAd,CAAsB,gBAAtB,EAAwC,QAAxC,CAAhB,GAAoEC,SAAnF;AACA,YAAMJ,QAAQ,+CAAsCF,MAAM,CAACE,QAAP,CAAgBG,OAAhB,CAAwB,gBAAxB,EAA0C,QAA1C,CAAtC,CAAd;;AAEA,YAAME,oBAAoB,GAAG,SAAUT,QAAQ,CAACU,KAAnB,EAA0BR,MAA1B,CAA7B;;AACA,YAAMS,cAAc,qBACfT,MADe;AAElBI,UAAAA,MAAM,EAANA,MAFkB;AAGlBF,UAAAA,QAAQ,EAARA;AAHkB,UAApB,CALiF,CAWjF;AACA;AACA;AACA;AACA;;AACAJ,QAAAA,QAAQ,CAACU,KAAT,CAAeD,oBAAf,IAAuCE,cAAvC;;AACAX,QAAAA,QAAQ,CAACC,WAAT,CAAqBU,cAArB;;AAEA;AACD;;AAEDX,MAAAA,QAAQ,CAACC,WAAT,CAAqBC,MAArB;AACD;AA1B8B;AAAA,CAAjC;;AA6BA,eAAeH,wBAAf","sourcesContent":["import { IRenderer } from 'fela';\nimport { RULE_TYPE } from 'fela-utils';\nimport * as _ from 'lodash';\n\ntype Renderer = IRenderer & {\n  cache: Record<string, RendererChange>;\n  _emitChange?: (change: RendererChange) => void;\n};\n\ntype RendererChange = {\n  type: 'RULE' | 'KEYFRAME' | 'FONT' | 'STATIC' | 'CLEAR';\n  className: string;\n  selector: string;\n  declaration: Object;\n  pseudo: string;\n  media: string;\n  support: string;\n};\n\n/**\n * A Fela enhancer that allows to use `:focus-visible`. Uses `what-input` library and its global\n * selector. Modifies generated selectors:\n * `.a:focus-visible {}` => `html[data-whatinput=\"keyboard\"] a:focus`.\n */\nconst felaFocusVisibleEnhancer = (renderer: Renderer) => ({\n  ...renderer,\n  _emitChange: (change: RendererChange) => {\n    if (change.type === RULE_TYPE && change.selector.indexOf(':focus-visible') !== -1) {\n      const pseudo = change.pseudo ? change.pseudo.replace(':focus-visible', ':focus') : undefined;\n      const selector = `html[data-whatinput=\"keyboard\"] ${change.selector.replace(':focus-visible', ':focus')}`;\n\n      const declarationReference = _.findKey(renderer.cache, change);\n      const enhancedChange = {\n        ...change,\n        pseudo,\n        selector,\n      };\n\n      // Fela has two types for rendering:\n      // - DOM via subscriptions that's why `_emitChange()` is replaced, it will notify all\n      //   subscriptions\n      // - static rendering, it directly accesses `.cache` via `clusterCache()` and generates\n      //   stylesheets from changes\n      renderer.cache[declarationReference] = enhancedChange;\n      renderer._emitChange(enhancedChange);\n\n      return;\n    }\n\n    renderer._emitChange(change);\n  },\n});\n\nexport default felaFocusVisibleEnhancer;\n"],"file":"felaFocusVisibleEnhancer.js"}