{"version":3,"sources":["components/Embed/Embed.tsx"],"names":["embedClassName","embedSlotClassNames","control","Embed","props","context","React","useContext","ThemeContext","displayName","telemetry","setStart","setEnd","alt","title","iframe","placeholder","video","variables","styles","className","design","ElementType","unhandledProps","handledProps","getA11yProps","accessibility","debugName","actionHandlers","performClick","event","handleClick","mapPropsToBehavior","rtl","defaultValue","defaultActive","value","active","initialValue","setACtive","useState","iframeLoaded","setIframeLoaded","frameRef","useRef","e","stopPropagation","preventDefault","iframeNil","newActive","handleFrameOverrides","predefinedProps","onLoad","current","contentWindow","focus","mapPropsToStyles","mapPropsToInlineStyles","classes","resolvedStyles","placeholderElement","image","width","height","hasIframe","hasVideo","controlVisible","placeholderVisible","element","root","onClick","Video","create","defaultProps","autoPlay","controls","loop","muted","poster","Box","as","overrideProps","propTypes","commonPropTypes","createCommon","children","content","PropTypes","bool","customPropTypes","itemShorthand","every","disallow","onActiveChange","func","string","embedBehavior","Object","keys","Component"],"mappings":"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","sourcesContent":["import { Accessibility, embedBehavior, EmbedBehaviorProps } from '@fluentui/accessibility';\nimport * as _ from 'lodash';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport * as customPropTypes from '@fluentui/react-proptypes';\n\nimport { createShorthandFactory, UIComponentProps, commonPropTypes } from '../../utils';\nimport Image from '../Image/Image';\nimport Video, { VideoProps } from '../Video/Video';\nimport Box, { BoxProps } from '../Box/Box';\nimport {\n  ComponentEventHandler,\n  WithAsProp,\n  ShorthandValue,\n  withSafeTypeForAs,\n  FluentComponentStaticProps,\n  ProviderContextPrepared,\n} from '../../types';\nimport { Ref } from '@fluentui/react-component-ref';\nimport {\n  getElementType,\n  useUnhandledProps,\n  useAutoControlled,\n  useAccessibility,\n  useTelemetry,\n  useStyles,\n} from '@fluentui/react-bindings';\n// @ts-ignore\nimport { ThemeContext } from 'react-fela';\n\nexport interface EmbedSlotClassNames {\n  control: string;\n}\n\nexport interface EmbedProps extends UIComponentProps {\n  /** Accessibility behavior if overridden by the user. */\n  accessibility?: Accessibility<EmbedBehaviorProps>;\n\n  /** Alternative text. */\n  alt?: string;\n\n  /** Corresponds to HTML title attribute. */\n  title?: string;\n\n  /** Whether the embedded object should be active. */\n  active?: boolean;\n\n  /** Whether the embedded object should start active. */\n  defaultActive?: boolean;\n\n  /** Shorthand for an control. */\n  control?: ShorthandValue<BoxProps>;\n\n  /** Shorthand for an embedded iframe. */\n  iframe?: ShorthandValue<BoxProps>;\n\n  /**\n   * Event for request to change 'active' value.\n   * @param event - React's original SyntheticEvent.\n   * @param data - All props and proposed value.\n   */\n  onActiveChange?: ComponentEventHandler<EmbedProps>;\n\n  /**\n   * Called when is clicked.\n   *\n   * @param event - React's original SyntheticEvent.\n   * @param data - All item props.\n   */\n  onClick?: ComponentEventHandler<EmbedProps>;\n\n  /** Image source URL for when video isn't playing. */\n  placeholder?: string;\n\n  /** Shorthand for an embedded video. */\n  video?: ShorthandValue<VideoProps>;\n}\n\nexport const embedClassName = 'ui-embed';\nexport const embedSlotClassNames: EmbedSlotClassNames = {\n  control: `${embedClassName}__control`,\n};\n\nexport type EmbedStylesProps = Required<Pick<EmbedProps, 'active'>> & { iframeLoaded: boolean };\n\nexport const Embed: React.FC<WithAsProp<EmbedProps>> & FluentComponentStaticProps<EmbedProps> = props => {\n  const context: ProviderContextPrepared = React.useContext(ThemeContext);\n  const { setStart, setEnd } = useTelemetry(Embed.displayName, context.telemetry);\n  setStart();\n  const { alt, title, control, iframe, placeholder, video, variables, styles, className, design } = props;\n  const ElementType = getElementType(props);\n  const unhandledProps = useUnhandledProps(Embed.handledProps, props);\n\n  const getA11yProps = useAccessibility<EmbedBehaviorProps>(props.accessibility, {\n    debugName: Embed.displayName,\n    actionHandlers: {\n      performClick: event => handleClick(event),\n    },\n    mapPropsToBehavior: () => ({\n      alt,\n      title,\n    }),\n    rtl: context.rtl,\n  });\n\n  const [active, setACtive] = useAutoControlled({\n    defaultValue: props.defaultActive,\n    value: props.active,\n    initialValue: false,\n  });\n\n  const [iframeLoaded, setIframeLoaded] = React.useState(false);\n  const frameRef = React.useRef<HTMLFrameElement>();\n\n  const handleClick = e => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const iframeNil = _.isNil(props.iframe);\n    const newActive = !active;\n\n    if (iframeNil || (!iframeNil && newActive)) {\n      setACtive(newActive);\n      _.invoke(props, 'onActiveChange', e, { ...props, active: newActive });\n    }\n\n    _.invoke(props, 'onClick', e, { ...props, active: newActive });\n  };\n\n  const handleFrameOverrides = predefinedProps => ({\n    onLoad: (e: React.SyntheticEvent) => {\n      _.invoke(predefinedProps, 'onLoad', e);\n      setIframeLoaded(true);\n      frameRef.current.contentWindow.focus();\n    },\n  });\n\n  const { classes, styles: resolvedStyles } = useStyles<EmbedStylesProps>(Embed.displayName, {\n    className: embedClassName,\n    mapPropsToStyles: () => ({\n      iframeLoaded,\n      active,\n    }),\n    mapPropsToInlineStyles: () => ({\n      className,\n      design,\n      styles,\n      variables,\n    }),\n    rtl: context.rtl,\n  });\n\n  const placeholderElement = placeholder ? (\n    <Image\n      src={placeholder}\n      styles={resolvedStyles.image}\n      variables={{ width: variables.width, height: variables.height }}\n    />\n  ) : null;\n\n  const hasIframe = !_.isNil(iframe);\n  const hasVideo = !_.isNil(video);\n  const controlVisible = !active || hasVideo;\n  const placeholderVisible = !active || (hasIframe && active && !iframeLoaded);\n\n  const element = (\n    <ElementType\n      {...getA11yProps('root', {\n        className: classes.root,\n        onClick: handleClick,\n        ...unhandledProps,\n      })}\n    >\n      {active && (\n        <>\n          {Video.create(video, {\n            defaultProps: () =>\n              getA11yProps('video', {\n                autoPlay: true,\n                controls: false,\n                loop: true,\n                muted: true,\n                poster: placeholder,\n                styles: resolvedStyles.video,\n                variables: {\n                  width: variables.width,\n                  height: variables.height,\n                },\n              }),\n          })}\n          {iframe && (\n            <Ref innerRef={frameRef}>\n              {Box.create(iframe, {\n                defaultProps: () =>\n                  getA11yProps('iframe', {\n                    as: 'iframe',\n                    styles: resolvedStyles.iframe,\n                  }),\n                overrideProps: handleFrameOverrides,\n              })}\n            </Ref>\n          )}\n        </>\n      )}\n\n      {placeholderVisible && placeholderElement}\n      {controlVisible &&\n        Box.create(control, {\n          defaultProps: () =>\n            getA11yProps('control', {\n              className: embedSlotClassNames.control,\n              styles: resolvedStyles.control,\n            }),\n        })}\n    </ElementType>\n  );\n\n  setEnd();\n\n  return element;\n};\n\nEmbed.displayName = 'Embed';\n\nEmbed.propTypes = {\n  ...commonPropTypes.createCommon({\n    children: false,\n    content: false,\n  }),\n  active: PropTypes.bool,\n  defaultActive: PropTypes.bool,\n  control: customPropTypes.itemShorthand,\n  iframe: customPropTypes.every([customPropTypes.disallow(['video']), customPropTypes.itemShorthand]),\n  onActiveChange: PropTypes.func,\n  onClick: PropTypes.func,\n  placeholder: PropTypes.string,\n  video: customPropTypes.every([customPropTypes.disallow(['iframe']), customPropTypes.itemShorthand]),\n};\n\nEmbed.defaultProps = {\n  as: 'span',\n  accessibility: embedBehavior,\n  control: {},\n};\n\nEmbed.handledProps = Object.keys(Embed.propTypes) as any;\n\nEmbed.create = createShorthandFactory({ Component: Embed });\n\n/**\n * An Embed displays content from external websites, like a post from external social network.\n *\n * @accessibility\n * A `placeholder` slot represents an [`Image`](/components/image/definition) component, please follow recommendations from its\n * accessibility section.\n */\nexport default withSafeTypeForAs<typeof Embed, EmbedProps, 'span'>(Embed);\n"],"file":"Embed.js"}