{"version":3,"sources":["components/Portal/Portal.tsx"],"names":["Portal","props","portalNode","triggerNode","triggerRef","e","trigger","unhandledProps","setState","open","state","context","target","renderPortal","renderTrigger","children","content","trapFocus","contentToRender","focusTrapZoneProps","length","handlePortalRef","handleMount","handleUnmount","rtlTextContainer","getAttributes","forElements","handleDocumentClick","triggerAccessibility","handleTriggerRef","React","cloneElement","onClick","handleTriggerClick","attributes","keyHandlers","AutoControlledComponent","commonPropTypes","createCommon","accessibility","as","className","styled","defaultOpen","PropTypes","bool","onMount","func","onUnmount","node","customPropTypes","ref","object","onTriggerClick","onOutsideClick","oneOfType"],"mappings":"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","sourcesContent":["import { AccessibilityAttributes } from '@fluentui/accessibility';\nimport { AccessibilityHandlerProps, FocusTrapZone, FocusTrapZoneProps } from '@fluentui/react-bindings';\nimport { EventListener } from '@fluentui/react-component-event-listener';\nimport { handleRef, Ref } from '@fluentui/react-component-ref';\nimport * as customPropTypes from '@fluentui/react-proptypes';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport * as _ from 'lodash';\n\nimport {\n  childrenExist,\n  AutoControlledComponent,\n  doesNodeContainClick,\n  ChildrenComponentProps,\n  commonPropTypes,\n  ContentComponentProps,\n  rtlTextContainer,\n} from '../../utils';\nimport PortalInner from './PortalInner';\n\nexport type TriggerAccessibility = {\n  attributes?: AccessibilityAttributes;\n  keyHandlers?: AccessibilityHandlerProps;\n};\n\nexport interface PortalProps extends ChildrenComponentProps, ContentComponentProps {\n  /** Initial value of open. */\n  defaultOpen?: boolean;\n\n  /**\n   * Called when the portal is mounted on the DOM.\n   *\n   * @param data - All props.\n   */\n  onMount?: (props: PortalProps) => void;\n\n  /**\n   * Called when the portal is unmounted from the DOM.\n   *\n   * @param data - All props.\n   */\n  onUnmount?: (props: PortalProps) => void;\n\n  /** Controls whether or not the portal is displayed. */\n  open?: boolean;\n\n  /** Element to be rendered in-place where the portal is defined. */\n  trigger?: JSX.Element;\n\n  /** Controls whether or not focus trap should be applied, using boolean or FocusTrapZoneProps type value */\n  trapFocus?: FocusTrapZoneProps | boolean;\n\n  /** Accessibility behavior object to apply on trigger node. */\n  triggerAccessibility?: TriggerAccessibility;\n\n  /** Sets trigger node to passed ref. */\n  triggerRef?: React.Ref<any>;\n\n  /**\n   * Called when trigger node was clicked.\n   *\n   * @param data - All props.\n   */\n  onTriggerClick?: (e: React.MouseEvent) => void;\n\n  /**\n   * Called when `click` event was invoked outside portal or trigger nodes.\n   *\n   * @param data - All props.\n   */\n  onOutsideClick?: (e: React.MouseEvent) => void;\n}\n\nexport interface PortalState {\n  open?: boolean;\n}\n\n/**\n * A Portal allows to render children outside of their parent.\n */\nclass Portal extends AutoControlledComponent<PortalProps, PortalState> {\n  portalNode: HTMLElement;\n  triggerNode: HTMLElement;\n\n  static autoControlledProps = ['open'];\n\n  static propTypes = {\n    ...commonPropTypes.createCommon({\n      accessibility: false,\n      as: false,\n      className: false,\n      styled: false,\n    }),\n    defaultOpen: PropTypes.bool,\n    onMount: PropTypes.func,\n    onUnmount: PropTypes.func,\n    open: PropTypes.bool,\n    trigger: PropTypes.node,\n    triggerRef: customPropTypes.ref,\n    triggerAccessibility: PropTypes.object,\n    onTriggerClick: PropTypes.func,\n    onOutsideClick: PropTypes.func,\n    trapFocus: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  };\n\n  static defaultProps: PortalProps = {\n    triggerAccessibility: {},\n  };\n\n  renderComponent(): React.ReactNode {\n    return (\n      <React.Fragment>\n        {this.renderPortal()}\n        {this.renderTrigger()}\n      </React.Fragment>\n    );\n  }\n\n  renderPortal(): JSX.Element | undefined {\n    const { children, content, trapFocus } = this.props;\n    const { open } = this.state;\n\n    const contentToRender = childrenExist(children) ? children : content;\n    const focusTrapZoneProps = (_.keys(trapFocus).length && trapFocus) || {};\n\n    return (\n      open && (\n        <Ref innerRef={this.handlePortalRef}>\n          <PortalInner\n            onMount={this.handleMount}\n            onUnmount={this.handleUnmount}\n            {...rtlTextContainer.getAttributes({ forElements: [contentToRender] })}\n          >\n            {trapFocus ? <FocusTrapZone {...focusTrapZoneProps}>{contentToRender}</FocusTrapZone> : contentToRender}\n            <EventListener listener={this.handleDocumentClick} target={this.context.target} type=\"click\" />\n          </PortalInner>\n        </Ref>\n      )\n    );\n  }\n\n  renderTrigger(): JSX.Element | undefined {\n    const { trigger, triggerAccessibility } = this.props;\n\n    return (\n      trigger && (\n        <Ref innerRef={this.handleTriggerRef}>\n          {React.cloneElement(trigger, {\n            onClick: this.handleTriggerClick,\n            ...triggerAccessibility.attributes,\n            ...triggerAccessibility.keyHandlers,\n          })}\n        </Ref>\n      )\n    );\n  }\n  handleMount = () => {\n    _.invoke(this.props, 'onMount', this.props);\n  };\n\n  handleUnmount = () => {\n    _.invoke(this.props, 'onUnmount', this.props);\n  };\n\n  handlePortalRef = (portalNode: HTMLElement) => {\n    this.portalNode = portalNode;\n  };\n\n  handleTriggerRef = (triggerNode: HTMLElement) => {\n    this.triggerNode = triggerNode;\n    handleRef(this.props.triggerRef, triggerNode);\n  };\n\n  handleTriggerClick = (e: React.MouseEvent, ...unhandledProps) => {\n    const { trigger } = this.props;\n\n    _.invoke(this.props, 'onTriggerClick', e); // Call handler from parent component\n    _.invoke(trigger, 'props.onClick', e, ...unhandledProps); // Call original event handler\n    this.setState({ open: !this.state.open });\n  };\n\n  handleDocumentClick = (e: MouseEvent) => {\n    if (\n      !this.portalNode || // no portal\n      doesNodeContainClick(this.triggerNode, e, this.context.target) || // event happened in trigger (delegate to trigger handlers)\n      doesNodeContainClick(this.portalNode, e, this.context.target) // event happened in the portal\n    ) {\n      return; // ignore the click\n    }\n    _.invoke(this.props, 'onOutsideClick', e);\n    this.setState({ open: false });\n  };\n}\n\nexport default Portal;\n"],"file":"Portal.js"}