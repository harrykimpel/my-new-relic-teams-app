{"version":3,"sources":["utils/positioner/Popper.tsx"],"names":["useDeepMemo","memoFn","key","ref","React","useRef","current","value","Popper","props","align","children","enabled","flipBoundary","userModifiers","modifiers","offset","overflowBoundary","pointerTargetRef","position","positionFixed","positioningDependencies","rtl","targetRef","unstable_pinned","proposedPlacement","popperRef","contentRef","latestPlacement","useState","computedPlacement","setComputedPlacement","computedModifiers","name","options","createInstance","useCallback","reference","handleUpdate","state","placement","hasDocument","scrollParentElement","hasScrollableElement","ownerDocument","body","hasPointer","flipVariations","boundary","strategy","element","altBoundary","phase","fn","filter","Boolean","onFirstUpdate","PopperJs","createPopper","destroyInstance","destroy","scheduleUpdate","update","useEffect","child","Children","only","defaultProps"],"mappings":"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","sourcesContent":["import { useIsomorphicLayoutEffect } from '@fluentui/react-bindings';\nimport { Ref, isRefObject } from '@fluentui/react-component-ref';\nimport * as PopperJs from '@popperjs/core';\nimport * as _ from 'lodash';\nimport * as React from 'react';\n\nimport isBrowser from '../isBrowser';\nimport getBoundary from './getBoundary';\nimport getScrollParent from './getScrollParent';\nimport { getPlacement, applyRtlToOffset } from './positioningHelper';\nimport { PopperModifiers, PopperProps } from './types';\n\n/**\n * Memoize a result using deep equality. This hook has two advantages over\n * React.useMemo: it uses deep equality to compare memo keys, and it guarantees\n * that the memo function will only be called if the keys are unequal.\n * React.useMemo cannot be relied on to do this, since it is only a performance\n * optimization (see https://reactjs.org/docs/hooks-reference.html#usememo).\n *\n * Copied from https://github.com/apollographql/react-apollo/blob/master/packages/hooks/src/utils/useDeepMemo.ts.\n */\nfunction useDeepMemo<TKey, TValue>(memoFn: () => TValue, key: TKey): TValue {\n  const ref = React.useRef<{ key: TKey; value: TValue }>();\n\n  if (!ref.current || !_.isEqual(key, ref.current.key)) {\n    ref.current = { key, value: memoFn() };\n  }\n\n  return ref.current.value;\n}\n\n/**\n * Popper relies on the 3rd party library [Popper.js](https://github.com/FezVrasta/popper.js) for positioning.\n */\nconst Popper: React.FunctionComponent<PopperProps> = props => {\n  const {\n    align,\n    children,\n    enabled,\n    flipBoundary,\n    modifiers: userModifiers,\n    offset,\n    overflowBoundary,\n    pointerTargetRef,\n    position,\n    positionFixed,\n    positioningDependencies = [],\n    rtl,\n    targetRef,\n    unstable_pinned,\n  } = props;\n\n  const proposedPlacement = getPlacement({ align, position, rtl });\n\n  const popperRef = React.useRef<PopperJs.Instance>();\n  const contentRef = React.useRef<HTMLElement>(null);\n\n  const latestPlacement = React.useRef<PopperJs.Placement>(proposedPlacement);\n  const [computedPlacement, setComputedPlacement] = React.useState<PopperJs.Placement>(proposedPlacement);\n\n  const computedModifiers = useDeepMemo<any, PopperModifiers>(\n    () => [\n      offset && {\n        name: 'offset',\n        options: { offset: rtl ? applyRtlToOffset(offset) : offset },\n      },\n      ...userModifiers,\n    ],\n    [offset, flipBoundary, overflowBoundary, userModifiers],\n  );\n\n  const createInstance = React.useCallback(() => {\n    const reference: Element | PopperJs.VirtualElement =\n      targetRef && isRefObject(targetRef)\n        ? (targetRef as React.RefObject<Element>).current\n        : (targetRef as PopperJs.VirtualElement);\n\n    if (!enabled || !reference || !contentRef.current) {\n      return;\n    }\n\n    const handleUpdate = ({ state }: { state: Partial<PopperJs.State> }) => {\n      // PopperJS performs computations that might update the computed placement: auto positioning, flipping the\n      // placement in case the popper box should be rendered at the edge of the viewport and does not fit\n      if (state.placement !== latestPlacement.current) {\n        latestPlacement.current = state.placement;\n        setComputedPlacement(state.placement);\n      }\n    };\n\n    const hasDocument = isBrowser();\n    const scrollParentElement: Node | null = hasDocument ? getScrollParent(contentRef.current) : null;\n\n    const hasScrollableElement = scrollParentElement\n      ? scrollParentElement !== scrollParentElement.ownerDocument.body\n      : false;\n    const hasPointer = !!(pointerTargetRef && pointerTargetRef.current);\n\n    const modifiers: PopperModifiers = [\n      { name: 'flip', options: { flipVariations: true } },\n\n      /**\n       * unstable_pinned disables the flip modifier by setting flip.enabled to false; this\n       * disables automatic repositioning of the popper box; it will always be placed according to\n       * the values of `align` and `position` props, regardless of the size of the component, the\n       * reference element or the viewport.\n       */\n      unstable_pinned && { name: 'flip', enabled: false },\n\n      /**\n       * When the popper box is placed in the context of a scrollable element, we need to set\n       * preventOverflow.escapeWithReference to true and flip.boundariesElement to 'scrollParent'\n       * (default is 'viewport') so that the popper box will stick with the targetRef when we\n       * scroll targetRef out of the viewport.\n       */\n      hasScrollableElement && { name: 'flip', options: { boundary: 'clippingParents' } },\n      hasScrollableElement && { name: 'preventOverflow', options: { boundary: 'clippingParents' } },\n    ];\n\n    const options: PopperJs.Options = {\n      placement: proposedPlacement,\n      strategy: positionFixed ? 'fixed' : 'absolute',\n      modifiers: [\n        ...(modifiers as PopperJs.Options['modifiers']),\n\n        ...computedModifiers,\n\n        /**\n         * This modifier is necessary in order to render the pointer. Refs are resolved in effects, so it can't be\n         * placed under computed modifiers. Deep merge is not required as this modifier has only these properties.\n         */\n        {\n          name: 'arrow',\n          enabled: hasPointer,\n          options: {\n            element: pointerTargetRef && pointerTargetRef.current,\n          },\n        },\n\n        flipBoundary && {\n          name: 'flip',\n          options: {\n            altBoundary: true,\n            boundary: getBoundary(contentRef.current, flipBoundary),\n          },\n        },\n        overflowBoundary && {\n          name: 'preventOverflow',\n          options: {\n            altBoundary: true,\n            boundary: getBoundary(contentRef.current, overflowBoundary),\n          },\n        },\n\n        {\n          name: 'onUpdate',\n          enabled: true,\n          phase: 'afterWrite' as PopperJs.ModifierPhases,\n          fn: handleUpdate,\n        },\n      ].filter(Boolean),\n      onFirstUpdate: state => handleUpdate({ state }),\n    };\n\n    popperRef.current = PopperJs.createPopper(reference, contentRef.current, options);\n  }, [contentRef, computedModifiers, enabled, pointerTargetRef, positionFixed, proposedPlacement, targetRef]);\n\n  const destroyInstance = React.useCallback(() => {\n    if (popperRef.current) {\n      popperRef.current.destroy();\n      popperRef.current = null;\n    }\n  }, []);\n\n  const scheduleUpdate = React.useCallback(() => {\n    if (popperRef.current) {\n      popperRef.current.update();\n    }\n  }, []);\n\n  useIsomorphicLayoutEffect(() => {\n    createInstance();\n    return destroyInstance;\n  }, [createInstance]);\n\n  React.useEffect(scheduleUpdate, [...positioningDependencies, computedPlacement]);\n\n  const child =\n    typeof children === 'function'\n      ? children({ placement: computedPlacement, scheduleUpdate })\n      : (children as React.ReactElement);\n\n  return child ? <Ref innerRef={contentRef}>{React.Children.only(child)}</Ref> : null;\n};\n\nPopper.defaultProps = {\n  enabled: true,\n  modifiers: [],\n  positionFixed: false,\n  positioningDependencies: [],\n};\n\nexport default Popper;\n"],"file":"Popper.js"}