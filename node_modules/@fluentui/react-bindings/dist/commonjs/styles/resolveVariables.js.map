{"version":3,"sources":["styles/resolveVariables.ts"],"names":["variablesCache","WeakMap","resolveVariables","displayNames","theme","variables","enabledVariablesCaching","componentThemeVariables","effectiveDisplayNames","filter","displayName","componentVariables","has","set","variablesThemeCache","get","handlingDisplayName","length","mergeComponentVariables","map","siteVariables","undefined"],"mappings":";;;;;;;;;;;AAAA;;AASA,IAAMA,cAAc,GAAG,IAAIC,OAAJ,EAAvB;;AAEA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CACvBC,YADuB,EAEvBC,KAFuB,EAGvBC,SAHuB,EAIvBC,uBAJuB,EAKM;AAC7B,MAAIC,uBAAJ,CAD6B,CAG7B;;AACA,MAAMC,qBAAqB,GAAGL,YAAY,CAACM,MAAb,CAAoB,UAAAC,WAAW;AAAA,WAAI,CAAC,CAACN,KAAK,CAACO,kBAAN,CAAyBD,WAAzB,CAAN;AAAA,GAA/B,CAA9B,CAJ6B,CAM7B;AACA;AACA;AACA;;AAEA,MAAIJ,uBAAJ,EAA6B;AAC3B,QAAI,CAACN,cAAc,CAACY,GAAf,CAAmBR,KAAnB,CAAL,EAAgC;AAC9BJ,MAAAA,cAAc,CAACa,GAAf,CAAmBT,KAAnB,EAA0B,EAA1B;AACD;;AAED,QAAMU,mBAAmB,GAAGd,cAAc,CAACe,GAAf,CAAmBX,KAAnB,KAA6B,EAAzD,CAL2B,CAO3B;AACA;;AACA,QAAMY,mBAAmB,GAAGR,qBAAqB,CAACA,qBAAqB,CAACS,MAAtB,GAA+B,CAAhC,CAAjD;;AAEA,QAAI,CAACH,mBAAmB,CAACE,mBAAD,CAAxB,EAA+C;AAC7CF,MAAAA,mBAAmB,CAACE,mBAAD,CAAnB,GAA2CE,+EACtCV,qBAAqB,CAACW,GAAtB,CAA0B,UAAAT,WAAW;AAAA,eAAIN,KAAK,CAACO,kBAAN,CAAyBD,WAAzB,CAAJ;AAAA,OAArC,CADsC,GAEzCN,KAAK,CAACgB,aAFmC,CAA3C;AAGApB,MAAAA,cAAc,CAACa,GAAf,CAAmBT,KAAnB,EAA0BU,mBAA1B;AACD;;AAEDP,IAAAA,uBAAuB,GAAGO,mBAAmB,CAACE,mBAAD,CAA7C;AACD,GAnBD,MAmBO,IAAIR,qBAAqB,CAACS,MAAtB,KAAiC,CAArC,EAAwC;AAC7CV,IAAAA,uBAAuB,GAAG,sBAASH,KAAK,CAACO,kBAAN,CAAyBH,qBAAqB,CAAC,CAAD,CAA9C,CAAT,EAA6DJ,KAAK,CAACgB,aAAnE,KAAqF,EAA/G;AACD,GAFM,MAEA;AACLb,IAAAA,uBAAuB,GAAGW,+EACrBV,qBAAqB,CAACW,GAAtB,CAA0B,UAAAT,WAAW;AAAA,aAAIN,KAAK,CAACO,kBAAN,CAAyBD,WAAzB,CAAJ;AAAA,KAArC,CADqB,GAExBN,KAAK,CAACgB,aAFkB,CAA1B;AAGD;;AAED,MAAIf,SAAS,KAAKgB,SAAlB,EAA6B;AAC3B,WAAOd,uBAAP;AACD;;AAED,SAAO,qCACLA,uBADK,EAEL,yBAAYF,SAAZ,EAAuB,iBAAvB,CAFK,EAGLD,KAAK,CAACgB,aAHD,CAAP;AAID,CAnDD;;eAqDelB,gB","sourcesContent":["import {\n  callable,\n  ComponentVariablesInput,\n  ComponentVariablesObject,\n  mergeComponentVariables,\n  ThemePrepared,\n  withDebugId,\n} from '@fluentui/styles';\n\nconst variablesCache = new WeakMap<ThemePrepared, Record<string, ComponentVariablesObject>>();\n\nconst resolveVariables = (\n  displayNames: string[],\n  theme: ThemePrepared,\n  variables: ComponentVariablesInput | undefined,\n  enabledVariablesCaching: boolean | undefined,\n): ComponentVariablesObject => {\n  let componentThemeVariables: ComponentVariablesObject;\n\n  // Filter out components that doesn't have defined variables in theme\n  const effectiveDisplayNames = displayNames.filter(displayName => !!theme.componentVariables[displayName]);\n\n  //\n  // Simple caching model, works only if there is no `props.variables`\n  // Resolves variables for this component, cache the result in provider\n  //\n\n  if (enabledVariablesCaching) {\n    if (!variablesCache.has(theme)) {\n      variablesCache.set(theme, {});\n    }\n\n    const variablesThemeCache = variablesCache.get(theme) || {};\n\n    // const displayNames = { Foo: variables, Bar: undefined, Baz: undefined }\n    // This allows to avoid creating useless cache entries for `Bar` & `Baz` components\n    const handlingDisplayName = effectiveDisplayNames[effectiveDisplayNames.length - 1];\n\n    if (!variablesThemeCache[handlingDisplayName]) {\n      variablesThemeCache[handlingDisplayName] = mergeComponentVariables(\n        ...effectiveDisplayNames.map(displayName => theme.componentVariables[displayName]),\n      )(theme.siteVariables);\n      variablesCache.set(theme, variablesThemeCache);\n    }\n\n    componentThemeVariables = variablesThemeCache[handlingDisplayName];\n  } else if (effectiveDisplayNames.length === 1) {\n    componentThemeVariables = callable(theme.componentVariables[effectiveDisplayNames[0]])(theme.siteVariables) || {};\n  } else {\n    componentThemeVariables = mergeComponentVariables(\n      ...effectiveDisplayNames.map(displayName => theme.componentVariables[displayName]),\n    )(theme.siteVariables);\n  }\n\n  if (variables === undefined) {\n    return componentThemeVariables;\n  }\n\n  return mergeComponentVariables(\n    componentThemeVariables,\n    withDebugId(variables, 'props.variables'),\n  )(theme.siteVariables);\n};\n\nexport default resolveVariables;\n"],"file":"resolveVariables.js"}