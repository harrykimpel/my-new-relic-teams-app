{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport * as React from 'react';\n\nvar getDefinedProps = function getDefinedProps(props) {\n  var definedProps = {};\n  Object.keys(props).forEach(function (propName) {\n    if (props[propName] !== undefined) {\n      definedProps[propName] = props[propName];\n    }\n  });\n  return definedProps;\n};\n\nvar useStateManager = function useStateManager(managerFactory) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var _options$mapPropsToIn = options.mapPropsToInitialState,\n      mapPropsToInitialState = _options$mapPropsToIn === void 0 ? function () {\n    return {};\n  } : _options$mapPropsToIn,\n      _options$mapPropsToSt = options.mapPropsToState,\n      mapPropsToState = _options$mapPropsToSt === void 0 ? function () {\n    return {};\n  } : _options$mapPropsToSt,\n      _options$sideEffects = options.sideEffects,\n      sideEffects = _options$sideEffects === void 0 ? [] : _options$sideEffects;\n  var latestActions = React.useMemo(function () {\n    return {};\n  }, [managerFactory]);\n  var latestManager = React.useRef(null); // Heads up! forceUpdate() is used only for triggering rerenders, stateManager is SSOT\n\n  var _ref = React.useReducer(function (c) {\n    return c + 1;\n  }, 0),\n      _ref2 = _slicedToArray(_ref, 2),\n      forceUpdate = _ref2[1]; // If manager exists, the current state will be used\n\n\n  var initialState = latestManager.current ? latestManager.current.state : getDefinedProps(mapPropsToInitialState());\n  latestManager.current = managerFactory({\n    // Factory has already configured actions\n    actions: {},\n    state: Object.assign({}, initialState, {}, getDefinedProps(mapPropsToState())),\n    sideEffects: [].concat(_toConsumableArray(sideEffects), [// `sideEffect` is called with two arguments, but hooks don't support the second callback\n    // argument\n    function () {\n      return forceUpdate();\n    }])\n  }); // We need to keep the same reference to an object with actions to allow usage them as\n  // a dependency in useCallback() hook\n\n  Object.assign(latestActions, latestManager.current.actions); // For development environments we disallow ability to extend object with other properties to\n  // avoid misusage\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (Object.isExtensible(latestActions)) Object.preventExtensions(latestActions);\n  } // We need to pass exactly `manager.state` to provide the same state object during the same render\n  // frame.\n  // It keeps behavior consistency between React state tools and our managers\n  // https://github.com/facebook/react/issues/11527#issuecomment-360199710\n  // Object.freeze() is used only in dev-mode to avoid usage mistakes\n\n\n  return {\n    state: process.env.NODE_ENV === 'production' ? latestManager.current.state : Object.freeze(latestManager.current.state),\n    actions: latestActions\n  };\n};\n\nexport default useStateManager;","map":{"version":3,"sources":["hooks/useStateManager.ts"],"names":["getDefinedProps","definedProps","Object","props","useStateManager","options","mapPropsToInitialState","mapPropsToState","sideEffects","latestActions","latestManager","React","forceUpdate","c","initialState","managerFactory","actions","state","process"],"mappings":"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","sourcesContent":["import { AnyAction, EnhancedActions, Manager, ManagerFactory, SideEffect } from '@fluentui/state';\nimport * as React from 'react';\n\ntype UseStateManagerOptions<State> = {\n  mapPropsToInitialState?: () => Partial<State>;\n  mapPropsToState?: () => Partial<State>;\n  sideEffects?: SideEffect<State>[];\n};\n\ntype UseStateManagerResult<State, Actions> = {\n  state: Readonly<State>;\n  actions: Readonly<Actions>;\n};\n\nconst getDefinedProps = <Props extends Record<string, any>>(props: Props): Partial<Props> => {\n  const definedProps: Partial<Props> = {};\n\n  Object.keys(props).forEach(propName => {\n    if (props[propName] !== undefined) {\n      (<Record<string, any>>definedProps)[propName] = props[propName];\n    }\n  });\n\n  return definedProps;\n};\n\nconst useStateManager = <State extends Record<string, any>, Actions extends Record<string, AnyAction>>(\n  managerFactory: ManagerFactory<State, Actions>,\n  options: UseStateManagerOptions<State> = {},\n): UseStateManagerResult<State, Actions> => {\n  const {\n    mapPropsToInitialState = () => ({} as Partial<State>),\n    mapPropsToState = () => ({} as Partial<State>),\n    sideEffects = [],\n  } = options;\n  const latestActions = React.useMemo<Actions>(() => ({} as Actions), [managerFactory]);\n  const latestManager = React.useRef<Manager<State, Actions> | null>(null);\n\n  // Heads up! forceUpdate() is used only for triggering rerenders, stateManager is SSOT\n  const [, forceUpdate] = React.useReducer((c: number) => c + 1, 0) as [never, () => void];\n\n  // If manager exists, the current state will be used\n  const initialState = latestManager.current ? latestManager.current.state : getDefinedProps(mapPropsToInitialState());\n\n  latestManager.current = managerFactory({\n    // Factory has already configured actions\n    actions: {} as EnhancedActions<State, Actions>,\n    state: { ...initialState, ...getDefinedProps(mapPropsToState()) },\n    sideEffects: [\n      ...sideEffects,\n      // `sideEffect` is called with two arguments, but hooks don't support the second callback\n      // argument\n      () => forceUpdate(),\n    ],\n  });\n\n  // We need to keep the same reference to an object with actions to allow usage them as\n  // a dependency in useCallback() hook\n  Object.assign(latestActions, latestManager.current.actions);\n\n  // For development environments we disallow ability to extend object with other properties to\n  // avoid misusage\n  if (process.env.NODE_ENV !== 'production') {\n    if (Object.isExtensible(latestActions)) Object.preventExtensions(latestActions);\n  }\n\n  // We need to pass exactly `manager.state` to provide the same state object during the same render\n  // frame.\n  // It keeps behavior consistency between React state tools and our managers\n  // https://github.com/facebook/react/issues/11527#issuecomment-360199710\n  // Object.freeze() is used only in dev-mode to avoid usage mistakes\n\n  return {\n    state:\n      process.env.NODE_ENV === 'production' ? latestManager.current.state : Object.freeze(latestManager.current.state),\n    actions: latestActions,\n  };\n};\n\nexport default useStateManager;\n"]},"metadata":{},"sourceType":"module"}